package edu.ntnu.idi.stud.team10.sparesti.util;

import java.util.List;

import org.springframework.boot.context.event.ApplicationReadyEvent;
import org.springframework.context.ApplicationListener;
import org.springframework.stereotype.Component;

import edu.ntnu.idi.stud.team10.sparesti.dto.BadgeDto;
import edu.ntnu.idi.stud.team10.sparesti.dto.UserDto;
import edu.ntnu.idi.stud.team10.sparesti.enums.DifficultyLevel;
import edu.ntnu.idi.stud.team10.sparesti.enums.TimeInterval;
import edu.ntnu.idi.stud.team10.sparesti.model.Badge;
import edu.ntnu.idi.stud.team10.sparesti.model.ConsumptionChallenge;
import edu.ntnu.idi.stud.team10.sparesti.repository.UserRepository;
import edu.ntnu.idi.stud.team10.sparesti.service.*;

@Component
public class DataLoader implements ApplicationListener<ApplicationReadyEvent> {

  private final BadgeService badgeService;
  private final UserBadgeService userBadgeService;
  private final UserService userService;
  private final ConsumptionChallengeService consumptionChallengeService;
  private final UserChallengeService userChallengeService;
  private final UserRepository userRepository;
  private final SavingTipService savingTipService;

  public DataLoader(
      BadgeService badgeService,
      UserBadgeService userBadgeService,
      UserService userService,
      ConsumptionChallengeService consumptionChallengeService,
      UserChallengeService userChallengeService,
      UserRepository userRepository,
      SavingTipService savingTipService) {
    this.badgeService = badgeService;
    this.userBadgeService = userBadgeService;
    this.userService = userService;
    this.consumptionChallengeService = consumptionChallengeService;
    this.userChallengeService = userChallengeService;
    this.userRepository = userRepository;
    this.savingTipService = savingTipService;
  }

  @Override
  public void onApplicationEvent(ApplicationReadyEvent event) {
    initialize();
  }

  private void resetBadges() {
    List<Badge> allBadges = badgeService.getAllBadges();
    for (Badge badge : allBadges) {
      badgeService.deleteBadgeById(badge.getId());
    }
    badgeService.deleteAllBadges(); // Implement this method in BadgeService to delete all badges
  }

  private void initialize() {
    createBadges();
    createSavingTips(); // works only if DB is empty

    try {
      userService.getUserByEmail("admin@admin");
    } catch (NotFoundException e) {
      // User not found, proceed with creating the admin user
      // The admin is created normally, then elevated to admin status manually
      UserDto adminUser = new UserDto();
      adminUser.setEmail("admin@admin");
      adminUser.setPassword("password");
      adminUser.setProfilePictureUrl(
          "https://quiz-project-fullstack.s3.eu-north-1.amazonaws.com/09663791-e23b-427b-b8d4-a341664f4f0a_amongus.png");
      userService.addUser(adminUser);
      userRepository
          .findByEmail("admin@admin")
          .ifPresent(
              user -> {
                user.setRole("ADMIN");
                userRepository.save(user);
              });
    }

    Long adminUserId = userService.getUserByEmail("admin@admin").getId();

    BadgeDto loginBadge = badgeService.getBadgeByName("P√• god vei!");

    userBadgeService.giveUserBadge(adminUserId, loginBadge.getId());

    if (!userChallengeService.getSortedChallengesByUser(adminUserId).isEmpty()) {
      return;
    }

    ConsumptionChallenge challenge1 = new ConsumptionChallenge();
    challenge1.setTimeInterval(TimeInterval.valueOf("DAILY"));
    challenge1.setDifficultyLevel(DifficultyLevel.valueOf("EASY"));
    challenge1.setTitle("Spar 100 kr p√• kaffe");
    challenge1.setDescription("Ikke kj√∏p kaffe i dag og spar 10 kr");
    challenge1.setMediaUrl("‚òï");
    challenge1.setTargetAmount(100);
    challenge1.setProductCategory("kaffe");
    challenge1.setReductionPercentage(15.0);

    // Set challenge properties
    consumptionChallengeService.createChallenge(challenge1);
    userChallengeService.addChallengeToUser(adminUserId, challenge1.getId());

    ConsumptionChallenge challenge2 = new ConsumptionChallenge();
    challenge2.setTimeInterval(TimeInterval.valueOf("WEEKLY"));
    challenge2.setDifficultyLevel(DifficultyLevel.valueOf("MEDIUM"));
    challenge2.setTitle("Spar 100 kr p√• Red Bull");
    challenge2.setDescription("Ikke kj√∏p Red Bull i dag og spar 10 kr");
    challenge2.setMediaUrl("üßÉ");
    challenge2.setTargetAmount(100);
    challenge2.setProductCategory("Red Bull");
    challenge2.setReductionPercentage(15.0);

    consumptionChallengeService.createChallenge(challenge2);
    userChallengeService.addChallengeToUser(adminUserId, challenge2.getId());
  }

  private void createBadge(String name, String description, String imageUrl) {
    BadgeDto badgeDto = new BadgeDto();
    badgeDto.setName(name);
    badgeDto.setDescription(description);
    badgeDto.setImageUrl(imageUrl);
    badgeService.createBadge(badgeDto);
  }

  private void createBadges() {
    if (!badgeService.getAllBadges().isEmpty()) {
      return;
    }
    createBadge(
        "Sparesti",
        "Medalje for spart innenfor m√•nedtlig budjsett",
        "https://quiz-project-fullstack.s3.eu-north-1.amazonaws.com/badge_pig_cropped.png");
    createBadge(
        "Red Bull",
        "Medalje for √• spare 100 kr p√• Red Bull i uken",
        "https://quiz-project-fullstack.s3.eu-north-1.amazonaws.com/badge_cropped_red_bull.png");
    createBadge(
        "Kaffe",
        "Medalje for √• spare 150 kr p√• kaffe i uken",
        "https://quiz-project-fullstack.s3.eu-north-1.amazonaws.com/badge_cropped_coffee.png");
    createBadge(
        "P√• god vei!",
        "Medalje for √• logge inn",
        "https://quiz-project-fullstack.s3.eu-north-1.amazonaws.com/0-challenges.png\n");
    createBadge(
        "3 Utfordringer!",
        "Medalje for √• fullf√∏re 3 utfordringer",
        "https://quiz-project-fullstack.s3.eu-north-1.amazonaws.com/3-challenges.png\n");
    createBadge(
        "10 Utfordringer!",
        "Medalje for √• fullf√∏re 10 utfordringer",
        "https://quiz-project-fullstack.s3.eu-north-1.amazonaws.com/10-challenges.png\n");
    createBadge(
        "15 Utfordringer!",
        "Medalje for √• fullf√∏re 15 utfordringer",
        "https://quiz-project-fullstack.s3.eu-north-1.amazonaws.com/15-challenges.png\n");
    createBadge(
        "Bank Id",
        "Medalje for √• logge inn med Bank Id",
        "https://quiz-project-fullstack.s3.eu-north-1.amazonaws.com/bank_id.png\n");
    createBadge(
        "Kiwi",
        "Medalje for ikke √• handle p√• Kiwi p√• en uke",
        "https://quiz-project-fullstack.s3.eu-north-1.amazonaws.com/kiwi.png\n");
    createBadge(
        "Rema 1001",
        "Medalje for ikke √• handle p√• Rema 1001 p√• en uke",
        "https://quiz-project-fullstack.s3.eu-north-1.amazonaws.com/rema_1001.png\n");
    createBadge(
        "Spar",
        "Medalje for ikke √• handle p√• Spar p√• en uke ",
        "https://quiz-project-fullstack.s3.eu-north-1.amazonaws.com/spar.png\n");
    createBadge(
        "Bunin",
        "Medalje for ikke √• handle p√• Bunnpris p√• en uke",
        "https://quiz-project-fullstack.s3.eu-north-1.amazonaws.com/bunin.png\n");
    createBadge(
        "Budget",
        "Medalje for √• opprette et budsjett",
        "https://quiz-project-fullstack.s3.eu-north-1.amazonaws.com/budget.png\n");
    createBadge(
        "M√•nedtlig utfordring",
        "Medalje for √• fullf√∏re en m√•nedtlig utfordring",
        "https://quiz-project-fullstack.s3.eu-north-1.amazonaws.com/calendar.png\n");
    createBadge(
        "Kl√¶r",
        "Medalje for √• spare 500 kr p√• kl√¶r i m√•neden",
        "https://quiz-project-fullstack.s3.eu-north-1.amazonaws.com/clothes.png\n");
    createBadge(
        "Sparem√•l oppn√•dd",
        "Medalje for √• oppn√• et sparem√•l",
        "https://quiz-project-fullstack.s3.eu-north-1.amazonaws.com/completing_saving_goal.png\n");
    createBadge(
        "Profilbilde",
        "Medalje for √• endre profilbilde",
        "https://quiz-project-fullstack.s3.eu-north-1.amazonaws.com/profile_picture.png\n");
    createBadge(
        "Dagligvare handel",
        "Medalje for √• spare 500 kr p√• dagligvare handel i uken",
        "https://quiz-project-fullstack.s3.eu-north-1.amazonaws.com/shopping_cart.png\n");
    createBadge(
        "Luftballong klikkeren!",
        "Medalje for √• klikke p√• luftballongen",
        "https://quiz-project-fullstack.s3.eu-north-1.amazonaws.com/red_airballoon.png\n");
    createBadge(
        "Delt sparem√•l",
        "Medalje for √• dele et sparem√•l med andre brukere",
        "https://quiz-project-fullstack.s3.eu-north-1.amazonaws.com/shared_goal.png\n");
    createBadge(
        "Husk √• betal regninga!",
        "Medalje for √• legge til en regning til en kategori",
        "https://quiz-project-fullstack.s3.eu-north-1.amazonaws.com/recipt.png\n");
    createBadge(
        "Transport",
        "Medalje for √• spare 600 kr p√• transport i m√•neden",
        "https://quiz-project-fullstack.s3.eu-north-1.amazonaws.com/transportation.png\n");
  }

  private void createSavingTips() {
    if (savingTipService.noSavingTips()) {
      List<String> savingTips =
          List.of(
              "Visste du? √Ö sl√• av lysene n√•r du forlater et rom kan spare deg for omtrent 6 % p√• str√∏mregningen hver m√•ned. üí°",
              "Milj√∏tips: Ved √• senke termostaten med bare √©n grad om vinteren kan du redusere oppvarmingsregningen med opptil 8 %. ‚ùÑÔ∏è",
              "Budsjetteringsfakta: Personer som sporer utgiftene sine kan spare opptil 20 % mer enn de som ikke gj√∏r det. üìä",
              "Finansiell visdom: √Ö betale ned gjelden med h√∏yest rente f√∏rst kan spare deg for hundrevis i renteutgifter. üí≥",
              "Smart shopping: √Ö kj√∏pe ikke-bedervelige varer i bulk kan spare deg for opptil 50 % p√• n√∏dvendige husholdningsartikler. üõí",
              "Visste du? √Ö trekke ut st√∏pselet p√• elektronikk n√•r de ikke er i bruk, kan spare deg for opptil 1 000 kr i √•ret p√• energikostnader. üîå",
              "Matlagingstips: √Ö lage mat hjemme fire dager i uken kan spare deg for over 15 000 kr √•rlig sammenlignet med √• spise ute. üçΩÔ∏è",
              "Transportfakta: Regelmessig vedlikehold av bilen kan forbedre drivstoffeffektiviteten og spare deg for penger p√• bensin. üöó",
              "Energisparetips: √Ö vaske kl√¶r i kaldt vann kan spare opptil 90 % av energien brukt per vask. üß∫",
              "Sparestrategi: √Ö sette opp automatiske overf√∏ringer til sparekontoer kan hjelpe deg med √• spare uten √• tenke p√• det. üè¶",
              "Visste du? √Ö ta med egen kaffe p√• jobb kan spare deg for over 10 000 kr per √•r. ‚òï",
              "Milj√∏tips: √Ö bruke en gjenbrukbar vannflaske kan spare deg for opptil 2 600 kr i √•ret sammenlignet med √• kj√∏pe flaskevann. üç∂",
              "Budsjetteringstips: √Ö gjennomg√• abonnementstjenester √•rlig kan hjelpe deg med √• unng√• √• betale for noe du ikke bruker. üìù",
              "Smart shopping: √Ö sjekke priser p√• nettet f√∏r kj√∏p kan f√∏re til betydelige besparelser. üíª",
              "B√¶rekraftig livsstil: √Ö plante en hage kan redusere matvareutgiftene dine ved √• dyrke dine egne gr√∏nnsaker og urter. üå±",
              "Reisetips: √Ö bestille flybilletter p√• en tirsdag kan ofte resultere i lavere priser sammenlignet med andre dager. ‚úàÔ∏è",
              "Finansiell helse: √Ö jevnlig sjekke kredittscoren din kan hjelpe med √• forebygge svindel og forbedre dine finansielle muligheter. üìà",
              "Gjenbrukstips: √Ö selge unna ting du ikke bruker er en god m√•te √• f√• mer penger inn p√• kontoen! üîÑ",
              "Energisparende fakta: LED-p√¶rer bruker minst 75 % mindre energi, og varer 25 ganger lenger, enn gl√∏dep√¶rer. üí°",
              "Vannsparetips: √Ö reparere en lekk kran kan spare opptil 37 liter vann per dag. üíß",
              "Sparemotivasjon: √Ö sette kortsiktige √∏konomiske m√•l kan gj√∏re prosessen med √• spare penger mer h√•ndterbar og givende. üéØ",
              "Gjenbrukstips: Du kan spare en del penger dersom du kj√∏per brukt gjennom finn.no, Facebook marketplace, Tise, Letgo osv. üì¶",
              "Matlagingstips: Kast mindre mat! Spis alt du kj√∏per og bruk restene i stedet for √• kaste dem. Slik f√•r du ned matbudsjettet. ü•ó",
              "Sparetips: Bruk mindre enn du tjener. üêñ Elles kommer jeg og finner deg.",
              "Sparetips: Det er best √• handle dagligvarer for en hel uke. Jo flere ganger du er innom butikken, jo oftere blir fristelsen for impulskj√∏p. üõçÔ∏è",
              "Sparetips: Det er lurt √• handle i butikken n√•r man ikke er sulten. Sannsynligheten for impulskj√∏p er st√∏rre dersom du er sulten! ü•ñ",
              "Sparetips: Pr√∏v √• ha √®n eller flere kostnadsfrie dager i uken. Det er enklere enn du tror, og du vil spare mye! üóìÔ∏è",
              "√òkonomitips: Automatiser sparepengene dine til en h√∏yrentekonto for √• maksimere avkastningen. üìä",
              "Milj√∏vennlig tips: Bruk sykkel eller g√• til jobb minst to dager i uken for √• redusere transportkostnader og milj√∏p√•virkning. üö¥",
              "Smart forbruk: Unng√• impulskj√∏p ved alltid √• vente 24 timer f√∏r du kj√∏per varer du ikke trenger umiddelbart. ‚è≥",
              "Shoppingtips: Benytt deg av sesongsalg for √• kj√∏pe kl√¶r og elektronikk til sterkt reduserte priser. üéâ",
              "Hjemmetips: Isoler vinduer og d√∏rer for √• redusere varmetap og spare p√• oppvarmingskostnadene. üè†",
              "Kostholdstips: Planlegg ukens m√•ltider p√• forh√•nd og kj√∏p kun det du trenger, slik reduserer du matsvinn og sparer penger. üìÖ",
              "√òkonomitips: Betal alltid regningene dine i tide for √• unng√• forsinkelsesgebyrer. üßæ",
              "Reisetips: Sammenlign priser fra flere reisenettsteder f√∏r du bestiller ferie for √• finne de beste tilbudene. üåç",
              "Str√∏msparing: Sl√• av og trekk ut ladeapparater som ikke er i bruk for √• spare str√∏m. üîå",
              "Underholdningstips: Utbytt dyre TV-abonnementer med rimeligere streamingtjenester eller frie alternativer. üì∫",
              "Shoppingtips: Bruk lojalitetskort og apper som tilbyr rabatter og bonuser. üí≥",
              "Vannsparetips: Installer spare dusjhoder for √• redusere vannforbruket og spare p√• vannregningen. üöø",
              "Sparetips: Invest√©r i kvalitetsprodukter som varer lenger i stedet for billige alternativer som m√• erstattes ofte. üõçÔ∏è",
              "Husholdningstips: Rengj√∏r eller bytt ut filtrene i varme- og luftanlegg regelmessig for bedre effektivitet. üå¨Ô∏è",
              "Sparetips for barn: L√¶r barna om penger ved √• gi dem et ukentlig budsjett for sm√•utgifter. üë∂",
              "Helse√∏konomi: Prioriter regelmessige helsesjekker for √• forebygge dyrere behandlinger i fremtiden. üè•",
              "Investeringstips: Start tidlig med √• sette av en liten sum i aksjemarkedet for √• dra nytte av renters rente. üìà",
              "Energisparetips: Bytt til LED-lys i hele hjemmet for √• kutte ned p√• str√∏mregningen. üí°",
              "Matlagingstips: Bruk en trykkoker for √• spare b√•de tid og energi n√•r du lager mat. üç≤",
              "Sparetips: Bruk denne appen og spar milliarder med budsjetteringssystemet v√•rt! üòÉ",
              "Sparetips: Lag sparem√•l p√• appen for √• spare opp for noe konkret! \uD83C\uDF91");

      for (String tip : savingTips) {
        savingTipService.createSavingTip(tip);
      }
    }
  }
}
